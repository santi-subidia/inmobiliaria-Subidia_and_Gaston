@model Inmobiliaria.Models.Inmueble
@{
    ViewData["Title"] = "Detalles del inmueble";

    ViewData["PropietarioNombre"] = Model.Propietario?.NombreCompleto ?? "Desconocido";
    ViewData["TipoNombre"] = Model.Tipo?.Nombre ?? $"Tipo {Model.TipoId}";
}
<h2>@ViewData["Title"]</h2>

<!-- Imagen de Portada -->
@if (!string.IsNullOrEmpty(Model.Portada_Url))
{
    <div class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">
                <i class="fas fa-star text-warning"></i> Imagen Principal
            </h5>
            <a asp-controller="Imagen" asp-action="GaleriaInmueble" asp-route-inmuebleId="@Model.Id" 
               class="btn btn-outline-primary btn-sm">
                <i class="fas fa-th"></i> Gestionar Imágenes
            </a>
        </div>
        <div class="card-body p-0">
            <img src="@Model.Portada_Url" class="w-100" alt="Portada del inmueble" 
                 style="height: 400px; object-fit: cover;" />
        </div>
    </div>
}
else
{
    <div class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">
                <i class="fas fa-image text-muted"></i> Imagen Principal
            </h5>
            <a asp-controller="Imagen" asp-action="GaleriaInmueble" asp-route-inmuebleId="@Model.Id" 
               class="btn btn-outline-primary btn-sm">
                <i class="fas fa-plus"></i> Agregar Imágenes
            </a>
        </div>
        <div class="card-body text-center py-5">
            <i class="fas fa-image fa-3x text-muted mb-3"></i>
            <h5 class="text-muted">Sin imagen principal</h5>
            <p class="text-muted">Este inmueble no tiene una imagen de portada.</p>
        </div>
    </div>
}

<!-- Información del inmueble -->
<div class="card mb-4">
  <div class="card-header">
    <h5 class="mb-0">
      <i class="fas fa-info-circle"></i> Información del Inmueble
    </h5>
  </div>
  <div class="card-body">
    <dl class="row">
      <dt class="col-sm-3">Propietario</dt>
      <dd class="col-sm-9">@ViewData["PropietarioNombre"]</dd>

      <dt class="col-sm-3">Tipo</dt>
      <dd class="col-sm-9">@ViewData["TipoNombre"]</dd>

      <dt class="col-sm-3">Uso</dt>
      <dd class="col-sm-9">@Model.Uso</dd>

      <dt class="col-sm-3">Ambientes</dt>
      <dd class="col-sm-9">@Model.Ambientes</dd>

      <dt class="col-sm-3">Dirección</dt>
      <dd class="col-sm-9">@Model.Direccion</dd>

      <dt class="col-sm-3">Precio</dt>
      <dd class="col-sm-9">@Model.PrecioSugerido.ToString("C0")</dd>

      <dt class="col-sm-3">Coordenadas</dt>
      <dd class="col-sm-9">
        @(Model.CoordenadaLat?.ToString() ?? "-"), @(Model.CoordenadaLon?.ToString() ?? "-")
      </dd>

      <dt class="col-sm-3">Suspendido</dt>
      <dd class="col-sm-9">
        @(Model.Suspendido ? Html.Raw("<span class=\"badge bg-danger\">Sí</span>")
                           : Html.Raw("<span class=\"badge bg-success\">No</span>"))
      </dd>

      <dt class="col-sm-3">Observaciones</dt>
      <dd class="col-sm-9">@Model.Observaciones</dd>
    </dl>
  </div>
</div>

<!-- Galería de imágenes (Carrusel) -->
@if (ViewBag.Imagenes != null && ((IEnumerable<Inmobiliaria.Models.Imagen>)ViewBag.Imagenes).Any())
{
    var imagenes = (IEnumerable<Inmobiliaria.Models.Imagen>)ViewBag.Imagenes;
    <div class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">
                <i class="fas fa-images"></i> Galería de Imágenes (@imagenes.Count())
            </h5>
            <a asp-controller="Imagen" asp-action="GaleriaInmueble" asp-route-inmuebleId="@Model.Id" 
               class="btn btn-outline-primary btn-sm">
                <i class="fas fa-th"></i> Gestionar Galería
            </a>
        </div>
        <div class="card-body p-0">
            <div id="carouselImagenes" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-indicators">
                    @{int index = 0;}
                    @foreach (var imagen in imagenes)
                    {
                        <button type="button" data-bs-target="#carouselImagenes" data-bs-slide-to="@index" 
                                class="@(index == 0 ? "active" : "")" aria-label="Slide @(index + 1)"></button>
                        index++;
                    }
                </div>
                <div class="carousel-inner">
                    @{index = 0;}
                    @foreach (var imagen in imagenes)
                    {
                        <div class="carousel-item @(index == 0 ? "active" : "")">
                            <img src="@imagen.Url" class="d-block w-100" alt="Imagen del inmueble" 
                                 style="height: 350px; object-fit: cover;" />
                        </div>
                        index++;
                    }
                </div>
                @if (imagenes.Count() > 1)
                {
                    <button class="carousel-control-prev" type="button" data-bs-target="#carouselImagenes" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Anterior</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#carouselImagenes" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Siguiente</span>
                    </button>
                }
            </div>
        </div>
    </div>
}
else
{
    <div class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">
                <i class="fas fa-images text-muted"></i> Galería de Imágenes
            </h5>
            <a asp-controller="Imagen" asp-action="GaleriaInmueble" asp-route-inmuebleId="@Model.Id" 
               class="btn btn-outline-primary btn-sm">
                <i class="fas fa-plus"></i> Agregar a Galería
            </a>
        </div>
        <div class="card-body text-center py-4">
            <i class="fas fa-images fa-2x text-muted mb-3"></i>
            <h6 class="text-muted">Sin galería de imágenes</h6>
            <p class="text-muted mb-0">Este inmueble no tiene imágenes en la galería.</p>
        </div>
    </div>
}

<div class="mt-3">
  <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-primary">Editar</a>
  <a asp-action="Index" class="btn btn-secondary">Volver</a>
</div>
